---
title: "Backup Sync & Internal Structure"
sidebarTitle: "Structure & Sync"
description: "Describes how the backup is synced between devices and used for authenticating new devices."
---

import { UnsealedBackup, SealedBackup } from "/snippets/backup/terms.mdx";
import { RootKey, PersonalCustodyPackage } from "/snippets/terms.mdx";


Syncing is the operation by which a user **updates** their backup from an authenticated device. A backup sync (`/sync`) is unidirectional, with a mobile client providing an update when new files are included in the backup. The client only fetches remote updates in certain scenarios (see below).


## Unsealed Backup: Internal Structure

The <UnsealedBackup /> contains the encoded <RootKey /> for World App plus a set of raw files. The source of truth is the `BackupFormat` structure in [Bedrock](https://github.com/worldcoin/bedrock). The files back up all required self-custodial information that a user holds in their World App. In particular, today this is the user's World ID <PersonalCustodyPackage />s (or PCPs).

<Note>One of the challenges the system faces is that because the backup is end-to-end encrypted, the **Backup Service** cannot enforce any type of rules that prevent accidental data loss. For example, consider Client M in which the User gets their passport verified and hence obtains a PCP. If the user is also authenticated on Client N, and a backup sync is triggered from Client N, the PCP would be removed from the backup because Client N does not have it.</Note>

1. To determine when a file should be included in the backup, a module in World App will instruct the `ManifestManager` that it requires a file to be backed up. _For example, the `personal_custody` module (currently in Oxide) which handles the user's Orb verification will instruct the `ManifestManager` to include the user's Orb PCP in the backup after a user verifies. Without this, the user would not be able to make use of their Orb credential._
1. The `ManifestManager` is responsible for creating and maintaining the set of `BackupFileManifest`s. Each manifest contains the required information so that the backup module can craft the required <SealedBackup /> for updates.
    ```rust
    pub struct V0BackupFileManifest {
        file_path: String,
        manifest_last_updated_at: DateTime<Utc>,
        max_file_size_kb: u64,
        designator: BackupFileDesignator,
        checksum: [u8; 32],
    }
    ```
1. Other modules call `ManifestManager::store_file` and `ManifestManager::remove_file` to add or remove files from the backup. 

Removing a file requires specifying the checksum to be removed.

Symlink to prevent accidental data loss.


Manifesta re needed because the backup updates are sent encrypted......