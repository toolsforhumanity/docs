---
title: "Backup Flows"
sidebarTitle: "Flows"
description: "Detailed documentation on the key flows related to the World App backup system."
---

import { MainFactor } from "/snippets/backup/terms.mdx";

## BF-7. Factor Deletion
- This flow is triggered when the user deletes a <MainFactor /> from the UI.
- Sync Factors are not manually removed by the user. This is usually done through other flows (e.g. when logging out).
- Currently, Passkeys are enrolled into Turnkey to provide a fallback mechanism in case a Sync Factor is no longer available. When the requested operation cannot be completed with the Sync Factor (see `PUBLIC_KEY_NOT_FOUND` error), the client will use the Passkey to execute the operation instead.
- **Future Note**: The current flow assumes that Turnkey is only used for OIDC Factors. This may change in the future (e.g. to support non-PRF Passkeys).

```mermaid
flowchart LR
    A{"Removing the last Main factor?"} -- Yes --> EndDelete(["Delete the backup: BF-8"])
    A -- No --> C["backup-service: /delete-factor/challenge/keypair"]
    C --> D["backup-service: /delete-factor with factorId with Sync Factor"]
    D --> E{"Deleting an OIDC factor?"}
    E -- Yes --> F{"Deleting the last OIDC factor?"}
    F -- Yes --> G["Delete Turnkey Account (ACTIVITY_TYPE_DELETE_SUB_ORGANIZATION) with Sync Factor"]
    F -- No --> H["Delete OIDC Accouint from Turnkey (ACTIVITY_TYPE_DELETE_OAUTH_PROVIDERS) with Sync Factor"]
    G --> EndSuccess
    H --> EndSuccess

    E -- No -->I{"Deleting iCloud Keychain?"}
    I -- No --> EndSuccess
    I -- Yes --> J["Delete keypair from Keychain"]
    J --> EndSuccess(["End: Show Success"])
    
    G .- fail .-> K{Failed with PUBLIC_KEY_NOT_FOUND?}
    K -- No --> Fail["Retry 2 times with back-off. Log errors. After max retries, continue."]
    K -- Yes --> L{"User has Passkey?"}
    L -- Yes --> M["Delete Turnkey Account (ACTIVITY_TYPE_DELETE_SUB_ORGANIZATION) with Main Factor (Passkey)"]
    L -- No --> EndSuccess
    M --> EndSuccess

    H -. fail .-> N{Failed with PUBLIC_KEY_NOT_FOUND?}
    N -- Yes --> O["Create new Sync Factor in Turnkey Account using Passkey"]
    O --> P["Delete OIDC Accouint from Turnkey (ACTIVITY_TYPE_DELETE_OAUTH_PROVIDERS) with NEW Sync Factor"]
    P --> EndSuccess

    O -. fail .-> Fail
    P -. fail .-> Fail

    C -. fail .-> EndError(["End: Show Failure to User"])
    D -. fail .-> EndError

```